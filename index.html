<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash Count V9</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style> body { font-family: 'Cairo', sans-serif; } </style>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-100 text-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        const APP_PIN = "1234"; // رمز الدخول

        // --- أيقونات ---
        const Icon = ({ name, size = 20, className }) => {
            const iconRef = React.useRef(null);
            React.useEffect(() => { if (window.lucide) window.lucide.createIcons({ root: iconRef.current, name, attrs: { width: size, height: size, class: className } }); }, [name, size, className]);
            return <i ref={iconRef} data-lucide={name} className={className}></i>;
        };
        const Icons = { Lock: p=><Icon name="lock" {...p}/>, Unlock: p=><Icon name="unlock" {...p}/>, Calculator: p=><Icon name="calculator" {...p}/>, Wallet: p=><Icon name="wallet" {...p}/>, RefreshCcw: p=><Icon name="refresh-ccw" {...p}/>, Coins: p=><Icon name="coins" {...p}/>, User: p=><Icon name="user" {...p}/>, AlertTriangle: p=><Icon name="alert-triangle" {...p}/>, Download: p=><Icon name="download" {...p}/>, Upload: p=><Icon name="upload" {...p}/>, FileSpreadsheet: p=><Icon name="file-spreadsheet" {...p}/>, Save: p=><Icon name="save" {...p}/>, Printer: p=><Icon name="printer" {...p}/>, Trash2: p=><Icon name="trash-2" {...p}/>, Plus: p=><Icon name="plus" {...p}/>, ArrowDown: p=><Icon name="arrow-down-circle" {...p}/>, ArrowUp: p=><Icon name="arrow-up-circle" {...p}/>, X: p=><Icon name="x" {...p}/>, Check: p=><Icon name="check-circle" {...p}/>, Eye: p=><Icon name="eye" {...p}/> };

        const { useState, useEffect, useRef } = React;
        const CURRENCIES = { EGP: { name: 'جنيه مصري', symbol: 'EGP', denominations: [200, 100, 50, 20, 10, 5, 1, 0.5] }, USD: { name: 'دولار أمريكي', symbol: 'USD', denominations: [100, 50, 20, 10, 5, 2, 1] }, EUR: { name: 'يورو', symbol: 'EUR', denominations: [500, 200, 100, 50, 20, 10, 5] }, SAR: { name: 'ريال سعودي', symbol: 'SAR', denominations: [500, 100, 50, 10, 5, 1] } };
        const fmtCurr = (a, c='EGP') => new Intl.NumberFormat('en-US', { style: 'decimal', minimumFractionDigits: 2 }).format(a) + ' ' + c;
        const fmtNum = (n) => (!n && n!==0) ? '' : new Intl.NumberFormat('en-US').format(n);

        // --- الطباعة ---
        const openPrint = (data, teller) => {
            const w = window.open('', '_blank', 'width=900,height=800');
            if(!w) return alert("اسمح بالنوافذ المنبثقة");
            let title="إيصال Cash Count", lbl="عميل", clr="#000";
            if(data.type==='SUPPLY'){title="إيصال توريد";lbl="توريد للخزينة";clr="green";}
            else if(data.type==='TRANSFER'){title="إيصال تحويل";lbl="تحويل صادر";clr="orange";}
            
            const html = `<!DOCTYPE html><html dir="rtl" lang="ar"><head><title>Print #${data.id}</title><link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet"><style>body{font-family:'Cairo';padding:40px}table{width:100%;border-collapse:collapse;margin:20px 0}th,td{border:1px solid #000;padding:8px;text-align:center}th{background:#eee}.box{border:2px solid #000;padding:15px;text-align:center;margin:20px 0;font-weight:bold}.footer{display:flex;justify-content:space-between;margin-top:50px}</style></head><body>
            <h1 style="text-align:center;border-bottom:3px solid #000;padding-bottom:10px">${title}</h1>
            <div style="background:#f9f9f9;padding:10px;border:1px solid #000;display:flex;justify-content:space-between;font-weight:bold"><span>#${data.id}</span><span>${new Date(data.date).toLocaleString('ar-EG')}</span><span style="color:${clr}">${lbl}</span></div>
            <h3>الملخص (${data.currency})</h3>
            <table><tr><th>البيان</th><th>القيمة</th></tr>
            ${data.type!=='SUPPLY'?`<tr><td style="text-align:right">إجمالي الخارج (Out)</td><td>${fmtCurr(data.totalCashOut,data.currency)}</td></tr>`:''}
            ${data.type!=='TRANSFER'?`<tr><td style="text-align:right">إجمالي المستلم (In)</td><td>${fmtCurr(data.totalCashIn,data.currency)}</td></tr>`:''}
            ${data.type==='CUSTOMER'?`<tr><td style="text-align:right">الشيكات</td><td>${fmtCurr(data.totalChecks,data.currency)}</td></tr><tr><td style="text-align:right">المطلوب (Slips)</td><td>${fmtCurr(data.totalDepositsRequired,data.currency)}</td></tr>`:''}
            </table>
            ${data.type==='CUSTOMER'?`<div class="box">الفرق: ${fmtCurr(data.variance,data.currency)}<br/><small>${Math.abs(data.variance)<0.01?'✅ متطابقة':data.variance>0?'⚠️ زيادة':'⛔ عجز'}</small></div>`:''}
            ${data.totalCashIn>0?`<h4>تفاصيل الوارد (In)</h4><table><thead><tr><th>الفئة</th><th>العدد</th><th>القيمة</th></tr></thead><tbody>${Object.entries(data.cashInBreakdown).map(([d,c])=>c>0?`<tr><td>${d}</td><td>${c}</td><td>${fmtNum(c*d)}</td></tr>`:'').join('')}</tbody></table>`:''}
            ${data.totalCashOut>0?`<h4>تفاصيل الخارج (Out)</h4><table><thead><tr><th>الفئة</th><th>العدد</th><th>القيمة</th></tr></thead><tbody>${Object.entries(data.cashOutBreakdown).map(([d,c])=>c>0?`<tr><td>${d}</td><td>${c}</td><td>${fmtNum(c*d)}</td></tr>`:'').join('')}</tbody></table>`:''}
            ${data.checks?.length>0?`<h4>الشيكات</h4><ul>${data.checks.map(c=>`<li>${fmtNum(c.amount)}</li>`).join('')}</ul>`:''}
            ${data.deposits?.length>0?`<h4>الإيداعات</h4><ul>${data.deposits.map(d=>`<li>${fmtNum(d.amount)}</li>`).join('')}</ul>`:''}
            <div class="footer"><div>التيلر: ${teller}</div><div>المراجع: .................</div></div>
            <script>window.onload=function(){setTimeout(function(){window.print()},500)}<\/script></body></html>`;
            w.document.write(html); w.document.close();
        };

        // --- Login ---
        function Login({ onLogin }) {
            const [p, setP] = useState('');
            return (
                <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl p-8 w-full max-w-md text-center">
                        <Icons.Lock size={48} className="mx-auto mb-4 text-slate-700"/>
                        <h2 className="text-2xl font-bold mb-6">Cash Count</h2>
                        <input type="password" value={p} onChange={e=>setP(e.target.value)} className="w-full text-center text-2xl border-2 rounded-lg py-2 mb-4" placeholder="****" autoFocus/>
                        <button onClick={()=>p===APP_PIN?onLogin():alert('خطأ')} className="w-full bg-slate-800 text-white font-bold py-3 rounded-lg">دخول</button>
                    </div>
                </div>
            );
        }

        // --- Main App ---
        function App() {
            const [auth, setAuth] = useState(()=>sessionStorage.getItem('auth')==='1');
            const [view, setView] = useState('calc');
            const [teller, setTeller] = useState(()=>localStorage.getItem('teller')||'');
            const [vault, setVault] = useState(()=>JSON.parse(localStorage.getItem('vault_v9')) || (() => { const v={}; Object.keys(CURRENCIES).forEach(c=>{v[c]={}; CURRENCIES[c].denominations.forEach(d=>v[c][d]=0)}); return v; })());
            const [trans, setTrans] = useState(()=>JSON.parse(localStorage.getItem('trans_v9'))||[]);
            const fileRef = useRef(null);

            useEffect(()=>{
                if(auth) {
                    localStorage.setItem('teller', teller);
                    localStorage.setItem('vault_v9', JSON.stringify(vault));
                    localStorage.setItem('trans_v9', JSON.stringify(trans));
                    if(window.lucide) window.lucide.createIcons();
                }
            }, [vault, trans, teller, auth, view]);

            if(!auth) return <Login onLogin={()=>{setAuth(true); sessionStorage.setItem('auth','1')}}/>;

            const process = (data) => {
                const t = { ...data, id: Date.now(), date: new Date().toISOString(), tellerName: teller };
                setTrans(p => [t, ...p]);
                setVault(p => {
                    const nv = {...p}; const cv = nv[data.currency];
                    Object.entries(data.cashInBreakdown).forEach(([d,c]) => cv[d] = (cv[d]||0)+c);
                    Object.entries(data.cashOutBreakdown).forEach(([d,c]) => cv[d] = (cv[d]||0)-c);
                    return nv;
                });
                return t;
            };

            const backup = () => {
                const b = new Blob([JSON.stringify({vault, trans, teller, date: new Date()})], {type:'application/json'});
                const a = document.createElement('a'); a.href=URL.createObjectURL(b); a.download=`Backup_${teller}.json`; a.click();
            };
            const restore = (e) => {
                const f = e.target.files[0]; if(!f) return;
                const r = new FileReader(); r.onload=ev=>{ try{ const d=JSON.parse(ev.target.result); if(d.vault && d.trans){ if(confirm('استرجاع؟')) { setVault(d.vault); setTrans(d.trans); if(d.teller) setTeller(d.teller); alert('تم!'); } } }catch{alert('ملف خطأ')} }; r.readAsText(f); e.target.value=null;
            };

            return (
                <div className="min-h-screen bg-gray-100 text-gray-900" dir="rtl">
                    <nav className="bg-slate-900 text-white shadow sticky top-0 z-40 p-2">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center">
                            <div className="flex items-center gap-2 font-bold text-xl mb-2 md:mb-0"><Icons.Coins className="text-yellow-500"/> Cash Count</div>
                            <div className="flex items-center gap-4">
                                <div className="bg-slate-800 px-3 py-1 rounded flex items-center gap-2 border border-slate-600">
                                    <Icons.User size={16}/><input value={teller} onChange={e=>setTeller(e.target.value)} placeholder="اسم التيلر" className="bg-transparent border-none text-white w-32 focus:outline-none font-bold text-sm"/>
                                </div>
                                <button onClick={()=>{setAuth(false);sessionStorage.removeItem('auth')}} className="text-red-400 text-xs border border-red-900 px-2 py-1 rounded">خروج</button>
                            </div>
                            <div className="flex gap-2 mt-2 md:mt-0">
                                {['calc','vault','hist'].map(v => <button key={v} onClick={()=>setView(v)} className={`px-3 py-1 rounded text-sm font-bold ${view===v?'bg-yellow-500 text-black':'text-gray-300'}`}>{v==='calc'?'العمليات':v==='vault'?'الخزينة':'السجل'}</button>)}
                            </div>
                        </div>
                    </nav>
                    <main className="max-w-7xl mx-auto px-4 py-6">
                        <div className="bg-white p-2 rounded shadow mb-4 flex justify-between items-center text-sm">
                            <span className="flex gap-1 text-gray-500"><Icons.AlertTriangle size={16} className="text-yellow-600"/> احفظ Backup يومياً</span>
                            <div className="flex gap-2">
                                <button onClick={backup} className="flex gap-1 px-2 py-1 bg-blue-50 text-blue-700 rounded border border-blue-200"><Icons.Download size={14}/> حفظ</button>
                                <button onClick={()=>fileRef.current.click()} className="flex gap-1 px-2 py-1 bg-gray-50 text-gray-700 rounded border border-gray-300"><Icons.Upload size={14}/> استرجاع</button>
                                <input type="file" ref={fileRef} onChange={restore} className="hidden"/>
                            </div>
                        </div>
                        {view==='calc' && <Calc onProcess={process} onPrint={d=>openPrint(d,teller)} />}
                        {view==='vault' && <Vault vault={vault} onProcess={process} />}
                        {view==='hist' && <Hist trans={trans} onPrint={d=>openPrint(d,teller)} />}
                    </main>
                </div>
            );
        }

        // --- Calc View ---
        function Calc({ onProcess, onPrint }) {
            const [curr, setCurr] = useState('EGP');
            const [inp, setInp] = useState({});
            const [out, setOut] = useState({});
            const [chks, setChks] = useState([]);
            const [slips, setSlips] = useState([]);

            const calc = (obj) => Object.entries(obj).reduce((s,[d,c])=>s+(d*c),0);
            const sum = (arr) => arr.reduce((s,i)=>s+i.a,0);
            
            const totIn = calc(inp), totOut = calc(out), totChks = sum(chks), totSlips = sum(slips);
            const variance = (totIn + totChks) - totOut - totSlips;

            const reset = () => { setInp({}); setOut({}); setChks([]); setSlips([]); };
            
            const getPayload = (id) => ({
                id, type: 'CUSTOMER', date: new Date().toISOString(), currency: curr,
                cashInBreakdown: inp, totalCashIn: totIn,
                cashOutBreakdown: out, totalCashOut: totOut,
                checks: chks.map(c=>({amount: c.a})), totalChecks: totChks,
                deposits: slips.map(s=>({amount: s.a})), totalDepositsRequired: totSlips,
                variance
            });

            const save = () => {
                if(!totIn && !totChks && !totSlips) return alert('لا يوجد بيانات');
                const res = onProcess(getPayload('TEMP'));
                reset();
                alert(`تم الحفظ #${res.id}`);
            };

            return (
                <div className="grid lg:grid-cols-12 gap-6 items-start">
                    <div className="lg:col-span-8 space-y-4">
                        <div className="bg-white p-3 rounded shadow border-t-4 border-yellow-500 flex justify-between">
                            <h2 className="font-bold text-lg">عملية عميل</h2>
                            <select value={curr} onChange={e=>{setCurr(e.target.value); reset()}} className="border p-1 rounded font-bold">{Object.keys(CURRENCIES).map(c=><option key={c} value={c}>{CURRENCIES[c].name}</option>)}</select>
                        </div>
                        <Denom title="1. نقدية واردة (In)" c={curr} val={inp} set={setInp} clr="blue"/>
                        <List title="2. شيكات" items={chks} set={setChks} icon="file-spreadsheet"/>
                        <List title="3. قسائم إيداع" items={slips} set={setSlips} icon="save" bg="bg-green-50"/>
                        <Denom title="4. نقدية خارجة (Out)" c={curr} val={out} set={setOut} clr="red"/>
                    </div>
                    <div className="lg:col-span-4 space-y-3 sticky top-20">
                        <div className="bg-white p-4 rounded shadow text-center">
                            <h3 className="font-bold border-b mb-2">الملخص</h3>
                            <div className="flex justify-between text-sm"><span>وارد:</span><b>{fmtNum(totIn)}</b></div>
                            <div className="flex justify-between text-sm"><span>شيكات:</span><b>{fmtNum(totChks)}</b></div>
                            <div className="flex justify-between font-bold border-t mt-1 pt-1"><span>المستلم:</span><span>{fmtNum(totIn+totChks)}</span></div>
                            <div className="flex justify-between text-sm text-blue-600 mt-2"><span>المطلوب:</span><b>{fmtNum(totSlips)}</b></div>
                            <div className="flex justify-between text-sm text-red-600"><span>المرتجع:</span><b>{fmtNum(totOut)}</b></div>
                            <div className={`text-3xl font-black my-2 ${Math.abs(variance)<0.01?'text-green-600':variance>0?'text-yellow-600':'text-red-600'}`}>{fmtCurr(variance,'')}</div>
                            <div className="font-bold text-sm">{Math.abs(variance)<0.01?'✅ متطابق':variance>0?'⚠️ زيادة':'⛔ عجز'}</div>
                        </div>
                        <div className="grid grid-cols-2 gap-2">
                            <button onClick={()=>openPrint(getPayload('مسودة'),'')} className="py-2 bg-gray-600 text-white rounded font-bold flex justify-center gap-1"><Icons.Printer size={18}/> طباعة</button>
                            <button onClick={()=>{if(confirm('تفريغ؟')) reset()}} className="py-2 bg-red-100 text-red-700 rounded font-bold flex justify-center gap-1"><Icons.Trash2 size={18}/> تفريغ</button>
                        </div>
                        <button onClick={save} className="w-full py-3 bg-slate-900 text-yellow-400 font-bold rounded shadow flex justify-center gap-2"><Icons.Save size={20}/> حفظ العملية</button>
                    </div>
                </div>
            );
        }

        // --- Vault View ---
        function Vault({ vault, onProcess }) {
            const [c, setC] = useState('EGP');
            const [mode, setMode] = useState(null); // SUPPLY or TRANSFER
            const [temp, setTemp] = useState({}); // Temporary counts for modal
            
            const curTot = Object.entries(vault[c]||{}).reduce((s,[d,count])=>s+(d*count),0);
            
            const commit = () => {
                onProcess({
                    type: mode, currency: c,
                    cashInBreakdown: mode==='SUPPLY'?temp:{}, totalCashIn: mode==='SUPPLY'?calc(temp):0,
                    cashOutBreakdown: mode==='TRANSFER'?temp:{}, totalCashOut: mode==='TRANSFER'?calc(temp):0,
                    checks:[], totalChecks:0, deposits:[], totalDepositsRequired:0, variance:0
                });
                setMode(null); setTemp({}); alert("تمت العملية");
            };
            const calc = (o) => Object.entries(o).reduce((s,[d,cnt])=>s+(d*cnt),0);

            return (
                <div className="space-y-6">
                    <div className="bg-white p-4 rounded shadow flex justify-between items-center">
                        <h2 className="font-bold text-lg">الخزينة</h2>
                        <div className="flex gap-2">
                            <select value={c} onChange={e=>setC(e.target.value)} className="border p-1 rounded font-bold">{Object.keys(CURRENCIES).map(k=><option key={k} value={k}>{CURRENCIES[k].name}</option>)}</select>
                            <button onClick={()=>{setMode('SUPPLY');setTemp({})}} className="bg-green-600 text-white px-3 py-1 rounded font-bold text-sm flex gap-1"><Icons.ArrowDown size={16}/> توريد</button>
                            <button onClick={()=>{setMode('TRANSFER');setTemp({})}} className="bg-orange-600 text-white px-3 py-1 rounded font-bold text-sm flex gap-1"><Icons.ArrowUp size={16}/> تحويل</button>
                        </div>
                    </div>
                    <div className="grid md:grid-cols-2 gap-4">
                        <div className="bg-white rounded shadow overflow-hidden">
                            <table className="w-full text-center text-sm">
                                <thead className="bg-slate-800 text-white"><tr><th>الفئة</th><th>العدد</th><th>القيمة</th></tr></thead>
                                <tbody>{CURRENCIES[c].denominations.map(d=><tr key={d} className="border-b"><td className="font-bold">{d}</td><td>{fmtNum(vault[c][d]||0)}</td><td className="text-gray-500">{fmtNum((vault[c][d]||0)*d)}</td></tr>)}</tbody>
                                <tfoot className="bg-gray-100 font-bold"><tr><td colSpan="2">الإجمالي</td><td className="text-blue-700">{fmtCurr(curTot,c)}</td></tr></tfoot>
                            </table>
                        </div>
                        <div className="bg-blue-50 p-6 rounded border border-blue-200 h-fit"><h3 className="font-bold text-blue-900 mb-2">الرصيد الفعلي</h3><div className="text-3xl font-bold text-blue-700">{fmtCurr(curTot,c)}</div></div>
                    </div>
                    {mode && <div className="fixed inset-0 bg-black/50 flex justify-center items-center z-50 p-4">
                        <div className="bg-white w-full max-w-md rounded shadow-lg overflow-hidden">
                            <div className={`p-3 text-white font-bold flex justify-between ${mode==='SUPPLY'?'bg-green-700':'bg-orange-700'}`}><span>{mode==='SUPPLY'?'توريد (In)':'تحويل (Out)'} - {c}</span><button onClick={()=>setMode(null)}><Icons.X/></button></div>
                            <div className="max-h-[60vh] overflow-y-auto p-2">
                                <Denom title="" c={c} val={temp} set={setTemp} clr={mode==='SUPPLY'?'green':'orange'} simple={true} />
                            </div>
                            <div className="bg-gray-100 p-3 flex justify-between items-center"><span className="font-bold">مجموع: {fmtNum(calc(temp))}</span><button onClick={commit} className={`px-4 py-2 text-white font-bold rounded ${mode==='SUPPLY'?'bg-green-600':'bg-orange-600'}`}>تأكيد</button></div>
                        </div>
                    </div>}
                </div>
            );
        }

        // --- Hist View ---
        function Hist({ trans, onPrint }) {
            const exp = () => {
                if(!trans.length) return;
                let csv = "\uFEFFID,Type,Teller,Date,Currency,In,Details In,Checks,Slips,Out,Details Out,Variance\n";
                trans.forEach(t => {
                    const di = Object.entries(t.cashInBreakdown).filter(x=>x[1]>0).map(x=>`${x[0]}x${x[1]}`).join(" | ");
                    const do_ = Object.entries(t.cashOutBreakdown).filter(x=>x[1]>0).map(x=>`${x[0]}x${x[1]}`).join(" | ");
                    const chks = t.checks?.map((c,i)=>`C${i+1}:${c.amount}`).join("|") || "";
                    const slps = t.deposits?.map((d,i)=>`S${i+1}:${d.amount}`).join("|") || "";
                    csv += `"${t.id}",${t.type},"${t.tellerName}","${t.date}",${t.currency},${t.totalCashIn},"${di}",${t.totalChecks} [${chks}],${t.totalDepositsRequired} [${slps}],${t.totalCashOut},"${do_}",${t.variance}\n`;
                });
                const a = document.createElement("a"); a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"})); a.download="Report.csv"; a.click();
            };
            return (
                <div className="space-y-4">
                    <div className="flex justify-between bg-white p-3 rounded shadow"><h2 className="font-bold text-lg">السجل</h2><button onClick={exp} className="bg-green-600 text-white px-3 py-1 rounded font-bold text-sm flex gap-1"><Icons.FileSpreadsheet size={16}/> Excel</button></div>
                    <div className="bg-white rounded shadow overflow-x-auto">
                        <table className="w-full text-right whitespace-nowrap text-sm">
                            <thead className="bg-gray-100"><tr><th className="p-2">#</th><th className="p-2">نوع</th><th className="p-2">تيلر</th><th className="p-2">تاريخ</th><th className="p-2">In</th><th className="p-2">Out</th><th className="p-2"></th></tr></thead>
                            <tbody>{trans.map(t=><tr key={t.id} className="border-b"><td className="p-2 font-mono">{t.id.toString().slice(-4)}</td><td className="p-2 font-bold text-xs">{t.type}</td><td className="p-2">{t.tellerName}</td><td className="p-2">{new Date(t.date).toLocaleTimeString()}</td><td className="p-2 text-green-700 font-bold">{t.totalCashIn>0?fmtNum(t.totalCashIn):'-'}</td><td className="p-2 text-red-700 font-bold">{t.totalCashOut>0?fmtNum(t.totalCashOut):'-'}</td><td className="p-2"><button onClick={()=>onPrint(t)} className="bg-gray-100 p-1 rounded hover:bg-gray-200"><Icons.Printer size={16}/></button></td></tr>)}</tbody>
                        </table>
                        {!trans.length && <div className="p-4 text-center text-gray-400">لا توجد عمليات</div>}
                    </div>
                </div>
            );
        }

        // --- Helpers ---
        const Denom = ({ title, c, val, set, clr, simple }) => {
            const tot = Object.entries(val).reduce((s,[d,count])=>s+(d*count),0);
            return (
                <div className={!simple?`bg-white rounded shadow border-t-4 border-${clr}-500`:''}>
                    {!simple && <div className="bg-gray-50 p-2 flex justify-between border-b"><h3 className={`font-bold text-${clr}-700`}>{title}</h3><span className="font-bold">{fmtCurr(tot,c)}</span></div>}
                    <div className="p-2">
                        {CURRENCIES[c].denominations.map(d=>(
                            <div key={d} className="flex items-center border-b last:border-0 py-1 text-sm">
                                <span className="w-12 font-bold">{d}</span>
                                <input type="number" min="0" placeholder="0" className="flex-1 text-center border rounded font-bold mx-2 py-1"
                                    value={val[d]||''} onChange={e=>{
                                        const nv = parseInt(e.target.value);
                                        const newVal = {...val};
                                        if(nv>0) newVal[d]=nv; else delete newVal[d];
                                        set(newVal);
                                    }}
                                    onFocus={e=>e.target.select()}
                                />
                                <span className="w-16 text-left text-gray-500 font-mono">{val[d]>0?fmtNum(val[d]*d):'-'}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const List = ({ title, items, set, icon, bg="bg-white" }) => {
            const [v, SV] = useState('');
            const add = () => { if(v){ set([...items,{id:Date.now(), a:parseFloat(v)}]); SV(''); }};
            const tot = items.reduce((s,i)=>s+i.a,0);
            return (
                <div className={`${bg} p-3 rounded shadow border border-gray-200`}>
                    <div className="flex justify-between mb-2 text-sm"><div className="flex gap-1 font-bold text-gray-700"><Icon name={icon} size={16}/>{title}</div><span className="bg-white px-1 border rounded font-mono">{fmtNum(tot)}</span></div>
                    <div className="flex gap-1 mb-2"><input type="number" className="flex-1 border rounded p-1 text-sm" value={v} onChange={e=>SV(e.target.value)} onKeyDown={e=>e.key==='Enter'&&add()} placeholder="القيمة" /><button onClick={add} className="bg-slate-700 text-white px-2 rounded"><Icons.Plus size={16}/></button></div>
                    <ul className="max-h-24 overflow-y-auto space-y-1">{items.map((i,idx)=><li key={i.id} className="flex justify-between bg-white px-2 py-1 border rounded text-xs"><span>#{idx+1}: <b>{fmtNum(i.a)}</b></span><button onClick={()=>set(items.filter(x=>x.id!==i.id))} className="text-red-500"><Icons.Trash2 size={12}/></button></li>)}</ul>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

